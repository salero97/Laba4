#include <iostream>
#include <vector>
#include <ctime> // для инициализации генератора случайных чисел времени
using namespace std;

// функция для инициализации массива s и перемешивания его с помощью ключа
void initRC4(vector<int>& s, const vector<int>& key) {
    int size = s.size(); // размер массива s, обычно 256
    // заполняем массив s последовательными числами от 0 до 255
    for (int i = 0; i < size; ++i) {
        s[i] = i;
    }
    int j = 0; // переменная для индекса j при перемешивании
    // перемешивание массива s с помощью ключа
    for (int i = 0; i < size; ++i) {
        // обновляем j с учетом текущего элемента и ключа
        j = (j + s[i] + key[i % key.size()]) % size;
        // меняем местами элементы s[i] и s[j]
        swap(s[i], s[j]);
    }
}

// функция для генерации следующего псевдослучайного байта
int rc4Next(vector<int>& s, int& i, int& j) {
    // увеличиваем индекс i по модулю размера массива
    i = (i + 1) % s.size();
    // увеличиваем индекс j по модулю размера массива
    j = (j + s[i]) % s.size();
    // меняем местами элементы s[i] и s[j]
    swap(s[i], s[j]);
    // вычисляем индекс t для получения байта
    int t = (s[i] + s[j]) % s.size();
    // возвращаем байт из массива s по индексу t
    return s[t];
}

int main() {
    // создаем массив s для состояния RC4 длиной 256
    vector<int> s(256);
    // создаем ключ для RC4, изначально пустой
    vector<int> key;
    // индексы i и j для алгоритма RC4
    int i = 0, j = 0;
    // переменная для количества чисел, которые нужно сгенерировать
    int count;

    // инициализация генератора случайных чисел


    // создаем ключ из 16 случайных байтов
    for (int k = 0; k < 16; ++k) {
        key.push_back(rand() % 256);
    }

    // инициализация алгоритма RC4 с помощью функции
    initRC4(s, key);

    // просим пользователя ввести количество чисел для генерации
    cout << "Введите количество псевдослучайных чисел: ";
    cin >> count;

    // выводим сгенерированные числа с помощью range-based for
    cout << "Псевдослучайные числа: ";
    // создаем временный контейнер для хранения сгенерированных чисел
    vector<int> generatedNumbers;
    for (int n = 0; n < count; ++n) {
        generatedNumbers.push_back(rc4Next(s, i, j));
    }
    // теперь выводим через range-based for
    for (const auto& num : generatedNumbers) {
        cout << num << " ";
    }
    cout << endl;

    return 0;
}
